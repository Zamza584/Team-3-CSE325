<!--  page "/account" -->
<!--  attribute [Authorize] -->
@page "/account"


<PageTitle>Account Settings</PageTitle>

<h3>Account Settings</h3>

<EditForm Model="@UserModel" OnValidSubmit="@SaveSettings">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label for="email">Email</label>
        <InputText id="email" @bind-Value="UserModel.Email" class="form-control" disabled />
        <small class="text-muted">Email cannot be changed</small>
    </div>

    <div class="form-group mb-3">
        <label for="displayName">Display Name</label>
        <InputText id="displayName" @bind-Value="UserModel.DisplayName" class="form-control" />
        <ValidationMessage For="@(() => UserModel.DisplayName)" />
    </div>

    <div class="form-group mb-3">
        <label for="phoneNumber">Phone Number</label>
        <InputText id="phoneNumber" @bind-Value="UserModel.PhoneNumber" class="form-control" />
        <ValidationMessage For="@(() => UserModel.PhoneNumber)" />
    </div>

    <h5 class="mt-4">Preferences</h5>
    
    <div class="form-check mb-3">
        <InputCheckbox id="emailNotifications" @bind-Value="UserModel.ReceiveEmailNotifications" class="form-check-input" />
        <label class="form-check-label" for="emailNotifications">Receive email notifications</label>
    </div>

    <div class="form-check mb-3">
        <InputCheckbox id="twoFactorEnabled" @bind-Value="UserModel.TwoFactorEnabled" class="form-check-input" />
        <label class="form-check-label" for="twoFactorEnabled">Enable two-factor authentication</label>
    </div>

    <div class="form-group mb-3">
        <label for="themePreference">Theme Preference</label>
        <InputSelect id="themePreference" @bind-Value="UserModel.ThemePreference" class="form-control">
            <option value="Light">Light</option>
            <option value="Dark">Dark</option>
            <option value="System">System Default</option>
        </InputSelect>
    </div>

    <div class="form-group mb-3">
        <label for="languagePreference">Language</label>
        <InputSelect id="languagePreference" @bind-Value="UserModel.LanguagePreference" class="form-control">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
            <!-- Add more languages as needed -->
        </InputSelect>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <button type="button" class="btn btn-secondary ms-2" @onclick="@Cancel">Cancel</button>
    </div>
</EditForm>

@code {
    private UserProfile UserModel = new UserProfile();
    private UserProfile OriginalModel = new UserProfile();
    
    protected override async Task OnInitializedAsync()
    {
        // Load user data from your authentication/API
        await LoadUserData();
    }
    
    private async Task LoadUserData()
    {
        // TODO: Replace with your actual data loading logic
        // Example: UserModel = await Http.GetFromJsonAsync<UserProfile>("api/account/profile");
        
        // Mock data for demonstration
        UserModel = new UserProfile
        {
            Email = "user@example.com",
            DisplayName = "John Doe",
            PhoneNumber = "+1234567890",
            ReceiveEmailNotifications = true,
            TwoFactorEnabled = false,
            ThemePreference = "Light",
            LanguagePreference = "en"
        };
        
        // Store original for cancel functionality
        OriginalModel = new UserProfile
        {
            Email = UserModel.Email,
            DisplayName = UserModel.DisplayName,
            PhoneNumber = UserModel.PhoneNumber,
            ReceiveEmailNotifications = UserModel.ReceiveEmailNotifications,
            TwoFactorEnabled = UserModel.TwoFactorEnabled,
            ThemePreference = UserModel.ThemePreference,
            LanguagePreference = UserModel.LanguagePreference
        };
    }
    
    private async Task SaveSettings()
    {
        // TODO: Replace with your actual save logic
        // Example: await Http.PutAsJsonAsync("api/account/profile", UserModel);
        
        Console.WriteLine("Saving user settings...");
        // Show success message
    }
    
    private void Cancel()
    {
        // Restore original values
        UserModel = new UserProfile
        {
            Email = OriginalModel.Email,
            DisplayName = OriginalModel.DisplayName,
            PhoneNumber = OriginalModel.PhoneNumber,
            ReceiveEmailNotifications = OriginalModel.ReceiveEmailNotifications,
            TwoFactorEnabled = OriginalModel.TwoFactorEnabled,
            ThemePreference = OriginalModel.ThemePreference,
            LanguagePreference = OriginalModel.LanguagePreference
        };
    }
    
    public class UserProfile
    {
        [Required]
        [EmailAddress]
        public string Email { get; set; } = string.Empty;
        
        [Required]
        [StringLength(50, MinimumLength = 2)]
        public string DisplayName { get; set; } = string.Empty;
        
        [Phone]
        public string? PhoneNumber { get; set; }
        
        public bool ReceiveEmailNotifications { get; set; }
        public bool TwoFactorEnabled { get; set; }
        public string ThemePreference { get; set; } = "Light";
        public string LanguagePreference { get; set; } = "en";
    }
}