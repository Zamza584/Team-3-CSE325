@page "/register"
@rendermode InteractiveServer
@inject NavigationManager Nav
@inject UserService userService

<h1>Register Page</h1>
<p>Create a new account.</p>

@if (ErrorMessage is not null)
{
    <div
        style="color:#b00020; font-weight:600; padding: 12px; background-color: #ffebee; border-radius: 4px; margin-bottom: 16px; max-width:420px;">
        ‚ùå @ErrorMessage
    </div>
}

<form model="registerModel" onValidSubmit="RegisterUser" method="post" action="/account/register"
      style="max-width:820px;">
    <AntiforgeryToken />

    <div style="margin-bottom:16px;">
        <label style="display:block; margin-bottom:4px; font-weight:600;">Email</label>
        <InputText name="email" type="email" @bind-Value="registerModel.Email" class="form-control" required />
    </div>

    <div style="margin-bottom:16px;">
        <label style="display:block; margin-bottom:4px; font-weight:600;">First Name</label>
        <InputText name="firstName" type="text" @bind-Value="registerModel.FirstName" class="form-control" required />
    </div>

    <div style="margin-bottom:16px;">
        <label style="display:block; margin-bottom:4px; font-weight:600;">Last Name</label>
        <InputText name="lastName" type="text" @bind-Value="registerModel.LastName" class="form-control" required />
    </div>

    <div style="margin-bottom:16px;">
        <label style="display:block; margin-bottom:4px; font-weight:600;">Password</label>
        <InputText name="password" type="password" @bind-Value="registerModel.Password" class="form-control" required />
        <small style="color:#666; display:block; margin-top:4px;">
            Password must be at least 6 characters, contain 1 uppercase and 1 number
        </small>
    </div>

    <div style="margin-bottom:20px;">
        <label style="display:block; margin-bottom:4px; font-weight:600;">Confirm Password</label>
        <InputText name="confirmPassword" type="password" @bind-Value="registerModel.ConfirmPassword"
                   class="form-control" required />
    </div>

    <button type="submit" class="btn btn-primary">Create Account</button>

    <p style="margin-top:16px;">
        Already have an account? <a href="/login">Login here</a>
    </p>
</form>

@code {

    @* Display password class is found in models folder. *@
    DisplayPassword dp1 = new DisplayPassword();
    DisplayPassword dp2 = new DisplayPassword();

    private RegisterModel registerModel = new RegisterModel();

    private async Task RegisterUser()
    {
        await userService.Register(registerModel.Email, registerModel.Password, registerModel.FirstName,
registerModel.LastName);

    }

    private string? ErrorMessage
    {
        get
        {
            var q = Nav.ToAbsoluteUri(Nav.Uri).Query;
            if (q.Contains("error=pwdmatch")) return "Passwords do not match.";
            if (q.Contains("error=exists")) return "This email is already registered.";
            if (q.Contains("error=passwordlength")) return "Password must be at least 6 characters long.";
            if (q.Contains("error=passworddigit")) return "Password must contain at least one number.";
            if (q.Contains("error=passwordupper")) return "Password must contain at least one uppercase letter.";
            if (q.Contains("error=1")) return "Could not create account. Please check your information.";
            return null;
        }
    }
}